#!/usr/bin/env python3
"""
Script pour nettoyer les octets null des fichiers Python.
"""

import glob
import os
import sys
from pathlib import Path


def clean_null_bytes(filepath):
    """Nettoie les octets null d'un fichier."""
    try:
        with open(filepath, 'rb') as f:
            content = f.read()
        
        if b'\x00' in content:
            original_size = len(content)
            content = content.replace(b'\x00', b'')
            new_size = len(content)
            
            with open(filepath, 'wb') as f:
                f.write(content)
            
            print(f'âœ… NettoyÃ©: {filepath} ({original_size - new_size} octets null supprimÃ©s)')
            return True
        else:
            print(f'â­ï¸  IgnorÃ©: {filepath} (pas d\'octets null)')
            return False
            
    except Exception as e:
        print(f'âŒ Erreur avec {filepath}: {e}')
        return False

def main():
    """Fonction principale."""
    print("ğŸ§¹ NETTOYAGE DES OCTETS NULL")
    print("="*40)
    
    # RÃ©pertoires Ã  nettoyer
    directories = [
        'athalia_core',
        'scripts', 
        'tools',
        'bin',
        'tests',
        'plugins'
    ]
    
    total_files = 0
    cleaned_files = 0
    
    for directory in directories:
        if not os.path.exists(directory):
            continue
            
        print(f"\nğŸ“ Traitement de {directory}/")
        pattern = os.path.join(directory, '**', '*.py')
        
        for filepath in glob.glob(pattern, recursive=True):
            total_files += 1
            if clean_null_bytes(filepath):
                cleaned_files += 1
    
    print(f"\nğŸ“Š RÃ‰SUMÃ‰:")
    print(f"   Total de fichiers: {total_files}")
    print(f"   Fichiers nettoyÃ©s: {cleaned_files}")
    print(f"   Fichiers inchangÃ©s: {total_files - cleaned_files}")
    
    if cleaned_files > 0:
        print(f"\nğŸ‰ Nettoyage terminÃ©! {cleaned_files} fichiers ont Ã©tÃ© nettoyÃ©s.")
    else:
        print(f"\nâœ¨ Aucun octet null trouvÃ© dans les fichiers Python.")

if __name__ == "__main__":
    main() 
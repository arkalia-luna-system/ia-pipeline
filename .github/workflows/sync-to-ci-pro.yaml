name: Sync Develop to CI Professional

on:
  push:
    branches: [develop]

jobs:
  sync-to-ci-pro:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Sync to ci-cd-professional
        run: |
          echo "ðŸ”„ Synchronisation de develop vers ci-cd-professional..."

          # VÃ©rifier si la branche ci-cd-professional existe
          if git ls-remote --heads origin ci-cd-professional | grep -q ci-cd-professional; then
            echo "âœ… Branche ci-cd-professional existe, mise Ã  jour..."
            git fetch origin ci-cd-professional
            git checkout ci-cd-professional
            git merge develop --no-edit
          else
            echo "ðŸ†• CrÃ©ation de la branche ci-cd-professional..."
            git checkout -b ci-cd-professional
          fi

          # Pousser les changements
          git push origin ci-cd-professional

          echo "âœ… Synchronisation terminÃ©e !"

      - name: Generate Sync Report
        if: always()
        run: |
          cat > sync_report.md << EOF
          # ðŸ”„ RAPPORT DE SYNCHRONISATION

          ## ðŸ“… Date: $(date)
          ## ðŸŒ¿ Branche source: develop
          ## ðŸŽ¯ Branche cible: ci-cd-professional
          ## ðŸ‘¤ Acteur: ${{ github.actor }}

          ### âœ… Actions effectuÃ©es:
          - Synchronisation automatique de develop vers ci-cd-professional
          - Mise Ã  jour de la branche CI/CD professionnelle
          - DÃ©clenchement automatique des workflows CI/CD pro

          ### ðŸ“ˆ Impact:
          - **CI/CD Pro mise Ã  jour** avec les derniers changements
          - **Tests automatiques** dÃ©clenchÃ©s sur ci-cd-professional
          - **Progression visible** dans les mÃ©triques

          ### ðŸš€ Prochaines Ã©tapes:
          - VÃ©rifier les rÃ©sultats des workflows CI/CD pro
          - Analyser les rapports de progression
          - Valider les amÃ©liorations avant migration

          EOF

      - name: Upload Sync Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: sync-report
          path: sync_report.md
